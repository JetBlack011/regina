#!/bin/sh
# Script to start regina.
set -e

# --- Check command-line options. ---

for i; do
	if [ "$i" = "--verbose" -o "$i" = "-v" ]; then
		export REGINA_VERBOSITY=2
	elif [ "$i" = "--quiet" -o "$i" = "-q" ]; then
		export REGINA_VERBOSITY=0
	fi
done

# --- Read runtime options. ---

. "`dirname "$0"`/scripts/regscript_opt"

# --- Set the classpath. ---

reginaclasses=""
for i in "$REGINA_JARDIR"/*.jar; do
	reginaclasses="$reginaclasses:$i";
done

export CLASSPATH="$reginaclasses:$REGINA_BTOOLS:$REGINA_JYTHON:$REGINA_JAVAHELP:$REGINA_EXTRACLASSES:$CLASSPATH"

# --- Set the Java defines. ---

addjavadef () {
	eval "javadefs=\"\$javadefs \\\"-D$1=\$$1\\\"\""
}
use_java_defs="REGINA_ENGINE REGINA_INTERFACE REGINA_JNIENGINE REGINA_CORBAHOST REGINA_CORBAPORT"

javadefs="\"-Djava.library.path=$REGINA_JNIDIR\""
addjavadef "REGINA_OPTIONS_LOCAL"
for i in $use_java_defs; do
	if ( eval "[ ! -z \"\$$i\" ]" ); then
		addjavadef $i
	fi
done

# --- Run the application. ---

command="$REGINA_JAVA $javadefs normal.Application $@"

info "Command: $command"
info "Classpath: $CLASSPATH"

if ! ( eval $command ); then
	error
	error "################################"
	error "#                              #"
	error "#            REGINA            #"
	error "#                              #"
	error "#  Could not run application!  #"
	error "#                              #"
	error "################################"
	error
	error "An error occurred whilst trying to run the application.  Use:"
	error
	error "    $0 --verbose"
	error
	error "to see more diagnostic output such as the runtime options"
	error "that are being used.  You may wish to verify that these"
	error "options are correct and edit the runtime options file(s)"
	error "if appropriate."
	error
	error "If you still can't run the application, mail $support"
	error "for assistance."
	error
	exit 1
fi
