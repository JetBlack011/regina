#!/bin/sh
#
# Regina - A Normal Surface Theory Calculator
# CVS Utility Script
#
# Copyright (c) 2002, Ben Burton
# For further details contact Ben Burton (benb@acm.org).
#
# Regenerates ../configure.ac.
#
# This script should NOT be run directly; to use it run "make -f Makefile.cvs"
# from the top-level source directory (the directory above this).
#
# This file is free software; you can redistribute it and/or
# modify it under the terms of the GNU General Public License as
# published by the Free Software Foundation; either version 2 of the
# License, or (at your option) any later version.
#
# This file is distributed in the hope that it will be useful, but
# WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
# General Public License for more details.
#
# You should have received a copy of the GNU General Public
# License along with this program; if not, write to the Free
# Software Foundation, Inc., 59 Temple Place, Suite 330, Boston,
# MA 02111-1307, USA.
#

set -e

# Are we in the top-level source directory?

if ! test -d admin; then
  echo "This script should not be run directly." 1>&2
  echo "To use it, run \"make -f Makefile.cvs\" from the top-level" 1>&2
  echo "source directory." 1>&2
  exit 1
fi

real=configure.ac
output=configure.ac.tmp

echo "Regenerating $real:"

# Actually generate the new file.

cat > "$output" <<EOF
dnl
dnl    DO NOT EDIT THIS FILE DIRECTLY if this source tree has been checked
dnl    out from CVS.  It has been automatically generated by Makefile.cvs
dnl    and any changes will be overwritten.  Try editing configure.ac.top
dnl    or configure.ac.bot instead.
EOF

cat configure.ac.top >> "$output"

echo "# List of Makefiles (automatically generated by Makefile.cvs):" \
  >> "$output"
for i in `find . -name Makefile.am | sort | sed -e 's#^./##;s#\.am$##'`; do
  case "$i" in
    ./Makefile )
      echo "AC_CONFIG_FILES([Makefile])" >> "$output"
    ;;
    * )
      echo "AC_CONFIG_FILES([$i])" >> "$output"
    ;;
  esac
done

cat configure.ac.bot >> "$output"

# Did configure.ac change?

real=configure.ac

if test -e "$real"; then
  if diff "$output" "$real" > /dev/null; then
    echo "File $real is unchanged."
    rm -f "$output"
  else
    echo "File $real has changed."
    rm -f "$real"
    mv "$output" "$real"
  fi
else
  echo "File $real is new."
  mv "$output" "$real"
fi

