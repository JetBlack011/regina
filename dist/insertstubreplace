#!/bin/sh
# Replaces the stub at the beginning of each file.
# Usage: insertstubreplace <sentry-string> <stub-file> [text file] ...
# Requires: insertstub, diff

sentry="$1"
stubfile=$2
shift 2

for srcfile
    do tmpfile=$srcfile.stub.tmp
    if (! ./insertstub "$sentry" $stubfile < $srcfile > $tmpfile); then
        if ! diff $srcfile $tmpfile > /dev/null; then
            if (test -s $tmpfile); then
                mv $tmpfile $srcfile
                echo "$srcfile: Stub replaced"
            else
                rm $tmpfile
                echo "$srcfile: *** FAILURE ***"
            fi
        else
            rm $tmpfile
            echo "$srcfile: Unchanged"
        fi
    else
        rm $tmpfile
        echo "$srcfile: Unchanged"
    fi
done
